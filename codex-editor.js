var codex=codex||{};codex.editor=function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";e.exports=function(e){var t=this;t.version="1.7.7",t.scriptPrefix="cdx-script-",t.modules={core:o(1),tools:o(2),ui:o(3),transport:o(4),renderer:o(5),saver:o(6),content:o(7),toolbar:o(8),callback:o(12),draw:o(13),caret:o(14),notifications:o(15),parser:o(16),sanitizer:o(17),listeners:o(19),destroyer:o(20),paste:o(21)};for(var n in t.modules)t.modules[n]=t.modules[n].call(t);return t.settings={tools:["paragraph","header","picture","list","quote","code","twitter","instagram","smile"],holderId:"codex-editor",initialBlockPlugin:"paragraph"},t.nodes={holder:null,wrapper:null,toolbar:null,inlineToolbar:{wrapper:null,buttons:null,actions:null},toolbox:null,notifications:null,plusButton:null,showSettingsButton:null,showTrashButton:null,blockSettings:null,pluginSettings:null,defaultSettings:null,toolbarButtons:{},redactor:null},t.state={jsonOutput:[],blocks:[],inputs:[]},t.tools={},t.start=function(e){t.modules.core.prepare(e).then(t.modules.ui.prepare).then(t.modules.sanitizer.prepare).then(t.modules.paste.prepare).then(t.modules.transport.prepare).then(t.modules.renderer.makeBlocksFromData).then(t.modules.ui.saveInputs).catch(function(e){t.modules.core.log("Initialization failed with error: %o","warn",e)})},t.start(e),{save:t.modules.saver.save}}},function(e,t){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(){var e={},t=this;e.prepare=function(e){return new Promise(function(n,r){e&&(t.settings.tools=e.tools||t.settings.tools),e.data&&(t.state.blocks=e.data),e.initialBlockPlugin&&(t.settings.initialBlockPlugin=e.initialBlockPlugin),e.sanitizer&&(t.settings.sanitizer=e.sanitizer),t.hideToolbar=e.hideToolbar,t.settings.placeholder=e.placeholder||"",t.nodes.holder=document.getElementById(e.holderId||t.settings.holderId),void 0===o(t.nodes.holder)||null===t.nodes.holder?r(Error("Holder wasn't found by ID: #"+e.holderId)):n()})},e.log=function(e,t,o){t=t||"log",o?e="[codex-editor]:      "+e:(o=e||"undefined",e="[codex-editor]:      %o");try{"console"in window&&window.console[t]&&(o?window.console[t](e,o):window.console[t](e))}catch(e){}},e.insertAfter=function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},e.nodeTypes={TAG:1,TEXT:3,COMMENT:8,DOCUMENT_FRAGMENT:11},e.keys={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,LEFT:37,UP:38,DOWN:40,RIGHT:39,DELETE:46,META:91},e.isDomNode=function(e){return e&&"object"===("undefined"==typeof e?"undefined":o(e))&&e.nodeType&&e.nodeType==this.nodeTypes.TAG},e.isEmpty=function(e){return 0===Object.keys(e).length},e.ajax=function(e){if(e&&e.url){var t,o,r,s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(e.async=!0,e.type=e.type||"GET",e.data=e.data||"",e["content-type"]=e["content-type"]||"application/json; charset=utf-8","GET"==e.type&&e.data)e.url=/\?/.test(e.url)?e.url+"&"+e.data:e.url+"?"+e.data;else{t="";for(r in e.data)t+=r+"="+encodeURIComponent(e.data[r])+"&"}e.withCredentials&&(s.withCredentials=!0);var l=void 0,i=void 0;if("function"!=typeof e.beforeSend||(i=e.beforeSend.call(),i!==!1))return s.open(e.type,e.url,e.async),o=n(e.data),o||("POST"!==e.type?s.setRequestHeader("Content-type",e["content-type"]):s.setRequestHeader("Content-type","application/x-www-form-urlencoded")),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),l=i||s,"function"==typeof e.progress&&(s.upload.onprogress=e.progress.bind(l)),s.onreadystatechange=function(){4===s.readyState&&(200===s.status?"function"==typeof e.success&&e.success.call(l,s.responseText):"function"==typeof e.error&&e.error.call(l,s.responseText,s.status))},o?s.send(e.data):s.send(t),s}},e.importScript=function(e,o){return new Promise(function(n,r){var s=void 0;o?document.getElementById(t.scriptPrefix+o)&&n(e):r("Instance name is missed"),s=document.createElement("SCRIPT"),s.async=!0,s.defer=!0,s.id=t.scriptPrefix+o,s.onload=function(){n(e)},s.onerror=function(){r(e)},s.src=e,document.head.appendChild(s)})};var n=function(e){return e instanceof FormData};return e.isNativeInput=function(e){var t=["INPUT","TEXTAREA"];return t.indexOf(e.tagName)!=-1},e.isBlockEmpty=function(e){var t=["IMG","IFRAME"],o=e.querySelectorAll("textarea, input"),n=!0,r=!e.textContent.trim();return Array.prototype.forEach.call(o,function(e){"textarea"!=e.type&&"text"!=e.type||(n=n&&!e.value.trim())}),r&&n&&!t.includes(e.tagName)},e}},function(e,t){"use strict";e.exports=function(){function e(){return new Promise(function(e,n){Promise.resolve().then(function(){var t=[],n=o.tools;for(var r in n){var s=n[r];s.prepare&&"function"!=typeof s.prepare||!s.prepare||t.push(s)}return t.length||e(),t}).then(t).then(function(){o.modules.core.log("Plugins loaded","info"),e()}).catch(function(e){n(e)})})}function t(e){return new Promise(function(t){e.reduce(function(r,s,l){return r.then(function(){return new Promise(function(r){n(s).then(r).then(function(){s.available=!0}).catch(function(e){o.modules.core.log("Plugin «"+s.type+"» was not loaded. Preparation failed because %o","warn",e),s.available=!1,s.loadingMessage=e,r()}).then(function(){l==e.length-1&&t()})})})},Promise.resolve())})}var o=this,n=function(e){return e.prepare(e.config||{})};return{prepare:e}}},function(e,t){"use strict";e.exports=function(){var e={},t=this;e.className={BLOCK_CLASSNAME:"ce-block",BLOCK_CONTENT:"ce-block__content",BLOCK_STRETCHED:"ce-block--stretched",BLOCK_HIGHLIGHTED:"ce-block--focused",SETTINGS_ITEM:"ce-settings__item"},e.prepare=function(){return new Promise(function(e){var o=t.modules.draw.wrapper(),r=t.modules.draw.redactor(),s=n();o.appendChild(s),o.appendChild(r),t.nodes.wrapper=o,t.nodes.redactor=r,t.nodes.holder.appendChild(o),e()}).then(i).then(o).then(a).then(l).then(d).catch(function(e){t.modules.core.log("Can't draw editor interface %o","warn",e)})};var o=function(){var e=t.modules.draw.inlineToolbar();t.nodes.inlineToolbar.wrapper=e,t.nodes.inlineToolbar.buttons=t.modules.draw.inlineToolbarButtons(),t.nodes.inlineToolbar.actions=t.modules.draw.inlineToolbarActions(),t.nodes.inlineToolbar.wrapper.appendChild(t.nodes.inlineToolbar.buttons),t.nodes.inlineToolbar.wrapper.appendChild(t.nodes.inlineToolbar.actions),t.nodes.wrapper.appendChild(t.nodes.inlineToolbar.wrapper)},n=function(){var e=t.modules.draw.toolbar(),o=s(),n=r();return e.appendChild(o),e.appendChild(n),t.nodes.toolbar=e,e},r=function(){var e=t.modules.draw.toolbarContent(),o=t.modules.draw.toolbox(),n=t.modules.draw.plusButton();return e.appendChild(n),e.appendChild(o),t.nodes.toolbox=o,t.nodes.plusButton=n,e},s=function(){var e=t.modules.draw.blockSettings(),o=t.modules.draw.blockButtons(),n=t.modules.draw.defaultSettings(),r=t.modules.draw.settingsButton(),s=t.modules.toolbar.settings.makeRemoveBlockButton(),l=t.modules.draw.pluginsSettings();return e.appendChild(l),e.appendChild(n),o.appendChild(r),o.appendChild(s),o.appendChild(e),t.nodes.blockSettings=e,t.nodes.pluginSettings=l,t.nodes.defaultSettings=n,t.nodes.showSettingsButton=r,t.nodes.showTrashButton=s,o},l=function(){t.nodes.notifications=t.modules.notifications.createHolder()},i=function(){var e,o,n;for(o in t.settings.tools){e=t.settings.tools[o],t.tools[o]=e;var r=e.instance();e.iconClassname||!e.displayInToolbox?"function"==typeof r.render?e.displayInToolbox&&(n=t.modules.draw.toolbarButton(o,e.iconClassname),t.nodes.toolbox.appendChild(n),t.nodes.toolbarButtons[o]=n):t.modules.core.log("render method missed. Tool %o skipped","warn",o):t.modules.core.log("Toolbar icon classname missed. Tool %o skipped","warn",o)}},a=function(){var e,o,n={bold:{icon:"ce-icon-bold",command:"bold"},italic:{icon:"ce-icon-italic",command:"italic"},link:{icon:"ce-icon-link",command:"createLink"}};for(var r in n)o=n[r],e=t.modules.draw.toolbarButtonInline(r,o.icon),t.nodes.inlineToolbar.buttons.appendChild(e),t.modules.ui.setInlineToolbarButtonBehaviour(e,o.command)},d=function(){t.modules.core.log("ui.bindEvents fired","info"),t.modules.listeners.add(document,"keydown",t.modules.callback.globalKeydown,!1),t.modules.listeners.add(t.nodes.redactor,"keydown",t.modules.callback.redactorKeyDown,!1),t.modules.listeners.add(document,"keyup",t.modules.callback.globalKeyup,!1),t.modules.listeners.add(t.nodes.redactor,"click",t.modules.callback.redactorClicked,!1),t.modules.listeners.add(t.nodes.plusButton,"click",t.modules.callback.plusButtonClicked,!1),t.modules.listeners.add(t.nodes.showSettingsButton,"click",t.modules.callback.showSettingsButtonClicked,!1);for(var e in t.nodes.toolbarButtons)t.modules.listeners.add(t.nodes.toolbarButtons[e],"click",t.modules.callback.toolbarButtonClicked,!1)};return e.addBlockHandlers=function(e){e&&(t.modules.listeners.add(e,"keydown",t.modules.callback.blockKeydown,!1),t.modules.listeners.add(e,"paste",t.modules.paste.blockPasteCallback,!1),t.modules.listeners.add(e,"mouseup",t.modules.toolbar.inline.show,!1),t.modules.listeners.add(e,"keyup",t.modules.toolbar.inline.show,!1))},e.saveInputs=function(){var e=t.nodes.redactor;t.state.inputs=[];var o=e.querySelectorAll("[contenteditable], input, textarea");Array.prototype.map.call(o,function(e){e.type&&"text"!=e.type&&"textarea"!=e.type||t.state.inputs.push(e)})},e.addInitialBlock=function(){var e,o=t.settings.initialBlockPlugin;return t.tools[o]?(e=t.modules.renderer.makeBlockFromData({type:o}),e.setAttribute("data-placeholder",t.settings.placeholder),t.modules.content.insertBlock({type:o,block:e}),void t.modules.content.workingNodeChanged(e)):void t.modules.core.log("Plugin %o was not implemented and can't be used as initial block","warn",o)},e.setInlineToolbarButtonBehaviour=function(e,o){t.modules.listeners.add(e,"mousedown",function(e){t.modules.toolbar.inline.toolClicked(e,o)},!1)},e}},function(e,t){"use strict";e.exports=function(){var e={},t=this,o=null;return e.input=null,e.arguments=null,e.prepare=function(){var e=t.modules.draw.node("INPUT","",{type:"file"});t.modules.listeners.add(e,"change",t.modules.transport.fileSelected),t.modules.transport.input=e},e.clearInput=function(){e.input=null,e.prepare()},e.fileSelected=function(){var n,r=this,s=r.files,l=new FormData;if(t.modules.transport.arguments.multiple===!0)for(n=0;n<s.length;n++)l.append("files[]",s[n],s[n].name);else l.append("files",s[0],s[0].name);o=t.core.ajax({type:"POST",data:l,url:t.modules.transport.arguments.url,beforeSend:t.modules.transport.arguments.beforeSend,success:t.modules.transport.arguments.success,error:t.modules.transport.arguments.error,progress:t.modules.transport.arguments.progress}),e.clearInput()},e.selectAndUpload=function(t){e.arguments=t,t.multiple===!0&&e.input.setAttribute("multiple","multiple"),t.accept&&e.input.setAttribute("accept",t.accept),e.input.click()},e.abort=function(){o.abort(),o=null},e}},function(e,t){"use strict";e.exports=function(){function e(e){var t=e.type,n=e.data;if(o.tools[t]){var r=o.tools[t],s=r.instance();if("function"==typeof s.render){var l=s.render(n);return l.tool=s,l}}}var t={},o=this;return t.makeBlocksFromData=function(){return o.modules.core.isEmpty(o.state.blocks)||!o.state.blocks.items.length?void o.modules.ui.addInitialBlock():t.appendBlocks(o.state.blocks).catch(function(e){o.modules.core.log("Error while parsing JSON: %o","error",e)})},t.appendBlocks=function(t){for(var n=t.items,r=[],s=0;s<n.length;s++)r.push(Promise.resolve(n[s]).then(e));return Promise.all(r).then(function(e){e.forEach(function(e){o.modules.content.insertBlock({block:e,type:e.tool.name})})})},t.appendNodeAtIndex=function(e,t,n){e.then(function(){return o.modules.renderer.getNodeAsync(t,n)}).then(o.modules.renderer.createBlockFromData).then(function(e){return o.modules.content.insertBlock(e),e.block}).catch(function(e){o.modules.core.log("Node skipped while parsing because %o","error",e)})},t.createBlockFromData=function(e){var t,n=e.tool,r=n.type;if(!o.tools[r])throw Error("Plugin «"+r+"» not found");if("function"!=typeof o.tools[r].render)throw Error("Plugin «"+r+"» must have «render» method");o.tools[r].available===!1?(t=o.modules.draw.unavailableBlock(),t.innerHTML=o.tools[r].loadingMessage,t.dataset.inputPosition=e.position):t=o.tools[r].render(n.data);var s=o.tools[r].isStretched||!1;return{type:r,block:t,stretched:s}},t.makeBlockFromData=e,t}},function(e,t){"use strict";e.exports=function(){var e={},t=this;e.save=function(){return t.state.html=t.nodes.redactor.innerHTML,t.state.jsonOutput=[],o(t.nodes.redactor.childNodes)};var o=function(e){for(var o=[],r=0;r<e.length;r++)o.push(n(e[r]));return Promise.all(o).then(l).catch(t.modules.core.log)},n=function(e){return r(e).then(s).catch(t.modules.core.log)},r=function(e){var o=e.childNodes[0].childNodes[0].tool;if(!t.tools[o.name])return t.modules.core.log("Plugin «"+o.name+"» not found","error"),{data:null,tool:null};if("function"!=typeof o.save)return t.modules.core.log("Plugin «"+o.name+"» must have save method","error"),{data:null,tool:null};var n=e.childNodes[0],r=n.childNodes[0],s=r.dataset.inputPosition;return t.tools[o.name].available===!1?Promise.resolve({data:codex.editor.state.blocks.items[s].data,tool:o}):Promise.resolve(r).then(o.save).then(function(e){return Object({data:e,tool:o})})},s=function(e){var t=e.data,o=e.tool;if(!t||!o)return!1;if(o.validate&&"function"==typeof o.validate){var n=o.validate(t);if(!n)return!1}return{data:t,tool:o}},l=function(e){e=e.filter(function(e){return e});var o=e.map(function(e){return Object({type:e.tool.name,data:e.data})});return t.state.jsonOutput=o,{id:t.state.blocks.id||null,time:+new Date,version:t.version,items:o}};return e}},function(e,t){"use strict";e.exports=function(){var e={},t=this;e.currentNode=null,e.editorAreaHightlighted=null,e.sync=function(){t.modules.core.log("syncing..."),t.state.html=t.nodes.redactor.innerHTML},e.markBlock=function(){t.modules.content.currentNode.classList.add(t.modules.ui.className.BLOCK_HIGHLIGHTED)},e.clearMark=function(){t.modules.content.currentNode&&t.modules.content.currentNode.classList.remove(t.modules.ui.className.BLOCK_HIGHLIGHTED)},e.getFirstLevelBlock=function(e){if(t.modules.core.isDomNode(e)||(e=e.parentNode),e===t.nodes.redactor||e===document.body)return null;for(;!e.classList.contains(t.modules.ui.className.BLOCK_CLASSNAME);)e=e.parentNode;return e},e.workingNodeChanged=function(o){t.modules.content.clearMark(),o&&(e.currentNode=e.getFirstLevelBlock(o))},e.replaceBlock=function(e,o){if(!e||!o)return void t.modules.core.log("replaceBlock: missed params");for(;!e.classList.contains(t.modules.ui.className.BLOCK_CLASSNAME);)e=e.parentNode;t.nodes.redactor.replaceChild(o,e),t.modules.content.workingNodeChanged(o),t.modules.ui.addBlockHandlers(o),t.modules.ui.saveInputs()},e.insertBlock=function(n,r){var s=t.modules.content.currentNode,l=n.block,i=n.type,a=n.stretched,d=o(l,i,a);if(s?t.modules.core.insertAfter(s,d):t.nodes.redactor.appendChild(d),t.modules.ui.addBlockHandlers(d),t.modules.content.workingNodeChanged(d),t.modules.ui.saveInputs(),r){var c=t.modules.caret.getCurrentInputIndex()||-1;if(c==-1){var u=d.querySelector("[contenteditable]"),m=document.createTextNode("");u.appendChild(m),t.modules.caret.set(u,0,0),t.modules.toolbar.move(),t.modules.toolbar.showPlusButton()}else{if(c===t.state.inputs.length-1)return;window.setTimeout(function(){t.modules.caret.setToNextBlock(c),t.modules.toolbar.move(),t.modules.toolbar.open()},10)}}e.editorAreaHightlighted=!1},e.switchBlock=function(e,n,r){r=r||t.modules.content.currentNode.dataset.tool;var s=o(n,r);t.modules.content.replaceBlock(e,s),t.modules.ui.saveInputs()},e.getDeepestTextNodeFromPosition=function(e,o){var n,r,s,l=e.childNodes;for(n=0;n<l.length;n++)r=l[n],r.nodeType==t.modules.core.nodeTypes.TEXT&&(s=r.textContent.trim(),""===s&&(e.removeChild(r),o--));if(0===e.childNodes.length)return document.createTextNode("");o<0&&(o=1);var i=!1;for(0===o&&(i=!0,o=1);o;)e=i?e.childNodes[0]:e.childNodes[o-1],e.nodeType==t.core.nodeTypes.TAG?o=e.childNodes.length:e.nodeType==t.core.nodeTypes.TEXT&&(o=0);return e};var o=function(e,o,n){var r=t.modules.draw.node("DIV",t.modules.ui.className.BLOCK_CLASSNAME,{}),s=t.modules.draw.node("DIV",t.modules.ui.className.BLOCK_CONTENT,{});return s.appendChild(e),r.appendChild(s),n&&s.classList.add(t.modules.ui.className.BLOCK_STRETCHED),r.dataset.tool=o,r};e.getRange=function(){var e=window.getSelection().getRangeAt(0);return e},e.splitBlock=function(e){var o,n,r,s,l=window.getSelection(),i=l.anchorNode,a=i.textContent,d=l.anchorOffset,c=t.modules.content.currentNode.querySelector("[contentEditable]");o=a.substring(0,d),r=a.substring(d),n=document.createTextNode(o),r&&(s=document.createTextNode(r));var u=[],m=[],p=!1;s&&m.push(s);for(var f,h=0;f=c.childNodes[h];h++)f!=i?p?m.push(f):u.push(f):p=!0;t.state.inputs[e].innerHTML="";var g=u.length;for(h=0;h<g;h++)t.state.inputs[e].appendChild(u[h]);t.state.inputs[e].appendChild(n);var v=m.length,b=document.createElement("div");for(h=0;h<v;h++)b.appendChild(m[h]);b=b.innerHTML;var k=t.settings.initialBlockPlugin;t.modules.content.insertBlock({type:k,block:t.tools[k].render({text:b})},!0)},e.mergeBlocks=function(e,o){if(0!==e){var n,r=t.state.inputs[e].innerHTML;n=o?t.state.inputs[o]:t.state.inputs[e-1],n.innerHTML+=r}},e.isLastNode=function(e){for(var o=!1;!o;){if(!n(e))return!1;e=e.parentNode,e.classList.contains(t.modules.ui.className.BLOCK_CONTENT)&&(o=!0)}return!0};var n=function(e){for(var t=e.nextSibling;t;){if(t.textContent.length)return!1;t=t.nextSibling}return!0};e.wrapTextWithParagraphs=function(e,t){if(!e.trim())return r(t);var o,n,s,l,i=document.createElement("DIV"),a=document.createElement("DIV"),d=["DIV","P"];for(i.innerHTML=e,n=document.createElement("P"),o=0;o<i.childNodes.length;o++)l=i.childNodes[o],s=d.indexOf(l.tagName)!=-1,s?(n.childNodes.length&&(a.appendChild(n.cloneNode(!0)),n=null,n=document.createElement("P")),a.appendChild(l.cloneNode(!0))):(n.appendChild(l.cloneNode(!0)),o==i.childNodes.length-1&&a.appendChild(n.cloneNode(!0)));return a.innerHTML};var r=function(e){return"<p>"+e.split("\n\n").join("</p><p>")+"</p>"};return e.getEditableParent=function(e){for(;e&&"true"!=e.contentEditable;)e=e.parentNode;return e},e.clear=function(e){t.nodes.redactor.innerHTML="",t.modules.content.sync(),t.modules.ui.saveInputs(),e?t.state.blocks={}:t.state.blocks&&(t.state.blocks.items=[]),t.modules.content.currentNode=null},e.load=function(e){var o=Object.assign({},t.state.blocks);t.modules.content.clear(),Object.keys(o).length?o.items?(o.items=o.items.concat(e.items),t.state.blocks=o):(o.items=e.items,t.state.blocks=o):t.state.blocks=e,t.modules.renderer.makeBlocksFromData()},e}},function(e,t,o){"use strict";e.exports=function(){var e={},t=this;return e.settings=o(9).call(t),e.inline=o(10).call(t),e.toolbox=o(11).call(t),e.defaultToolbarHeight=49,e.defaultOffset=34,e.opened=!1,e.current=null,e.open=function(){if(!t.hideToolbar){var e=t.modules.content.currentNode.childNodes[0].childNodes[0].tool;t.tools[e.name]&&e.makeSettings&&"function"==typeof e.makeSettings?t.nodes.showSettingsButton.classList.remove("hide"):t.nodes.showSettingsButton.classList.add("hide"),t.nodes.toolbar.classList.add("opened"),this.opened=!0}},e.close=function(){t.nodes.toolbar.classList.remove("opened"),e.opened=!1,e.current=null;for(var o in t.nodes.toolbarButtons)t.nodes.toolbarButtons[o].classList.remove("selected");t.modules.toolbar.toolbox.close(),t.modules.toolbar.settings.close()},e.toggle=function(){this.opened?this.close():this.open()},e.hidePlusButton=function(){t.nodes.plusButton.classList.add("hide")},e.showPlusButton=function(){t.nodes.plusButton.classList.remove("hide")},e.move=function(){if(t.modules.toolbar.toolbox.close(),t.modules.content.currentNode){var e=t.modules.content.currentNode.offsetTop-t.modules.toolbar.defaultToolbarHeight/2+t.modules.toolbar.defaultOffset;t.nodes.toolbar.style.transform="translate3D(0, "+Math.floor(e)+"px, 0)",t.modules.toolbar.settings.hideRemoveActions()}},e}},function(e,t){"use strict";e.exports=function(){var e={},t=this;return e.opened=!1,e.setting=null,e.actions=null,e.open=function(e){if(t.tools[e.name]&&e.makeSettings&&"function"==typeof e.makeSettings){var o=e.makeSettings();t.nodes.pluginSettings.appendChild(o),t.nodes.blockSettings.classList.add("opened"),this.opened=!0}},e.close=function(){t.nodes.blockSettings.classList.remove("opened"),t.nodes.pluginSettings.innerHTML="",this.opened=!1},e.toggle=function(e){this.opened?this.close():this.open(e)},e.makeRemoveBlockButton=function(){var e=t.modules.draw.node("SPAN","ce-toolbar__remove-btn",{}),o=t.modules.draw.node("SPAN","ce-toolbar__remove-setting",{innerHTML:'<i class="ce-icon-trash"></i>'}),n=t.modules.draw.node("DIV","ce-toolbar__remove-confirmation",{}),r=t.modules.draw.node("DIV","ce-toolbar__remove-confirm",{textContent:"Удалить блок"}),s=t.modules.draw.node("DIV","ce-toolbar__remove-cancel",{textContent:"Отмена"});return t.modules.listeners.add(o,"click",t.modules.toolbar.settings.removeButtonClicked,!1),t.modules.listeners.add(r,"click",t.modules.toolbar.settings.confirmRemovingRequest,!1),t.modules.listeners.add(s,"click",t.modules.toolbar.settings.cancelRemovingRequest,!1),n.appendChild(r),n.appendChild(s),e.appendChild(o),e.appendChild(n),t.modules.toolbar.settings.setting=o,t.modules.toolbar.settings.actions=n,e},e.removeButtonClicked=function(){var e=t.modules.toolbar.settings.actions;e.classList.contains("opened")?t.modules.toolbar.settings.hideRemoveActions():t.modules.toolbar.settings.showRemoveActions(),t.modules.toolbar.toolbox.close(),t.modules.toolbar.settings.close()},e.cancelRemovingRequest=function(){t.modules.toolbar.settings.actions.classList.remove("opened")},e.confirmRemovingRequest=function(){var e,o=t.modules.content.currentNode;o.remove(),e=t.nodes.redactor.childNodes.length,0===e&&(t.modules.content.currentNode=null,t.modules.ui.addInitialBlock()),t.modules.ui.saveInputs(),t.modules.toolbar.close()},e.showRemoveActions=function(){t.modules.toolbar.settings.actions.classList.add("opened")},e.hideRemoveActions=function(){t.modules.toolbar.settings.actions.classList.remove("opened")},e}},function(e,t){"use strict";e.exports=function(){var e={},t=this;e.buttonsOpened=null,e.actionsOpened=null,e.wrappersOffset=null,e.storedSelection=null,e.show=function(){var o,n=t.modules.content.currentNode,r=n.dataset.tool;if(o=t.tools[r],o.showInlineToolbar){var s=e.getSelectionText(),l=t.nodes.inlineToolbar.wrapper;s.length>0&&(t.modules.toolbar.inline.move(),l.classList.add("opened"),t.modules.toolbar.inline.showButtons())}},e.close=function(){var e=t.nodes.inlineToolbar.wrapper;e.classList.remove("opened")},e.move=function(){this.wrappersOffset||(this.wrappersOffset=this.getWrappersOffset());var e,o,n=this.getSelectionCoords(),r=0,s=t.nodes.inlineToolbar.wrapper;0===s.offsetHeight&&(r=40),e=n.x-this.wrappersOffset.left,o=n.y+window.scrollY-this.wrappersOffset.top-r-s.offsetHeight,s.style.transform="translate3D("+Math.floor(e)+"px, "+Math.floor(o)+"px, 0)",t.modules.toolbar.inline.closeButtons(),t.modules.toolbar.inline.closeAction()},e.toolClicked=function(e,o){switch(o){case"createLink":t.modules.toolbar.inline.createLinkAction(e,o);break;default:t.modules.toolbar.inline.defaultToolAction(o)}t.nodes.inlineToolbar.buttons.childNodes.forEach(t.modules.toolbar.inline.hightlight)},e.getWrappersOffset=function(){var e=t.nodes.wrapper,o=this.getOffset(e);return this.wrappersOffset=o,o},e.getOffset=function(e){for(var t=0,o=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft+e.clientLeft,o+=e.offsetTop+e.clientTop,e=e.offsetParent;return{top:o,left:t}},e.getSelectionCoords=function(){var e,t=document.selection,o=0,n=0;if(t)"Control"!=t.type&&(e=t.createRange(),e.collapse(!0),o=e.boundingLeft,n=e.boundingTop);else if(window.getSelection&&(t=window.getSelection(),t.rangeCount&&(e=t.getRangeAt(0).cloneRange(),e.getClientRects))){e.collapse(!0);var r=e.getClientRects()[0];if(!r)return;o=r.left,n=r.top}return{x:o,y:n}},e.getSelectionText=function(){var e="";return window.getSelection&&(e=window.getSelection().toString()),e},e.showButtons=function(){var e=t.nodes.inlineToolbar.buttons;e.classList.add("opened"),t.modules.toolbar.inline.buttonsOpened=!0,t.nodes.inlineToolbar.buttons.childNodes.forEach(t.modules.toolbar.inline.hightlight)},e.closeButtons=function(){var e=t.nodes.inlineToolbar.buttons;e.classList.remove("opened"),t.modules.toolbar.inline.buttonsOpened=!1},e.showActions=function(){var e=t.nodes.inlineToolbar.actions;e.classList.add("opened"),t.modules.toolbar.inline.actionsOpened=!0},e.closeAction=function(){var e=t.nodes.inlineToolbar.actions;e.innerHTML="",e.classList.remove("opened"),t.modules.toolbar.inline.actionsOpened=!1};var o=function(e){if(e.keyCode==t.core.keys.ENTER){var o=t.modules.content.currentNode,n=t.modules.toolbar.inline.storedSelection;t.modules.toolbar.inline.restoreSelection(o,n),t.modules.toolbar.inline.setAnchor(this.value),e.preventDefault(),e.stopImmediatePropagation(),t.modules.toolbar.inline.clearRange()}};return e.createLinkAction=function(e){var n=this.isLinkActive(),r=t.modules.content.currentNode,s=t.modules.toolbar.inline.saveSelection(r);if(t.modules.toolbar.inline.storedSelection=s,n)t.modules.toolbar.inline.restoreSelection(r,s),t.modules.toolbar.inline.defaultToolAction("unlink");else{var l=t.draw.inputForLink();t.nodes.inlineToolbar.actions.appendChild(l),t.modules.toolbar.inline.closeButtons(),t.modules.toolbar.inline.showActions(),l.focus(),e.preventDefault(),t.modules.listeners.add(l,"keydown",o,!1)}},e.isLinkActive=function(){var e=!1;return t.nodes.inlineToolbar.buttons.childNodes.forEach(function(t){var o=t.dataset.type;"link"==o&&t.classList.contains("hightlighted")&&(e=!0)}),e},e.defaultToolAction=function(e){document.execCommand(e,!1,null)},e.setAnchor=function(e){document.execCommand("createLink",!1,e),t.modules.toolbar.inline.closeAction()},e.saveSelection=function(e){var t,o=window.getSelection().getRangeAt(0),n=o.cloneRange();return n.selectNodeContents(e),n.setEnd(o.startContainer,o.startOffset),t=n.toString().length,{start:t,end:t+o.toString().length}},e.restoreSelection=function(e,t){var o=document.createRange(),n=0;o.setStart(e,0),o.collapse(!0);for(var r,s,l=[e],i=!1,a=!1;!a&&(r=l.pop());)if(3==r.nodeType)s=n+r.length,!i&&t.start>=n&&t.start<=s&&(o.setStart(r,t.start-n),i=!0),i&&t.end>=n&&t.end<=s&&(o.setEnd(r,t.end-n),a=!0),n=s;else for(var d=r.childNodes.length;d--;)l.push(r.childNodes[d]);var c=window.getSelection();c.removeAllRanges(),c.addRange(o)},e.clearRange=function(){var e=window.getSelection();e.removeAllRanges()},e.hightlight=function(e){var o=e.dataset.type;document.queryCommandState(o)?t.modules.toolbar.inline.setButtonHighlighted(e):t.modules.toolbar.inline.removeButtonsHighLight(e);var n=window.getSelection(),r=n.anchorNode.parentNode;"A"==r.tagName&&"link"==o&&t.modules.toolbar.inline.setButtonHighlighted(e)},e.setButtonHighlighted=function(e){if(e.classList.add("hightlighted"),"link"==e.dataset.type){var t=e.childNodes[0];t.classList.remove("ce-icon-link"),t.classList.add("ce-icon-unlink")}},e.removeButtonsHighLight=function(e){if(e.classList.remove("hightlighted"),"link"==e.dataset.type){var t=e.childNodes[0];t.classList.remove("ce-icon-unlink"),t.classList.add("ce-icon-link")}},e}},function(e,t){"use strict";e.exports=function(){var e={},t=this;return e.opened=!1,e.openedOnBlock=null,e.open=function(){t.modules.toolbar.settings.opened&&t.modules.toolbar.settings.close(),e.openedOnBlock=t.modules.content.currentNode,e.openedOnBlock.classList.add("toolbar-opened"),t.nodes.toolbox.classList.add("opened"),t.nodes.plusButton.classList.add("clicked"),t.modules.toolbar.toolbox.opened=!0},e.close=function(){e.openedOnBlock&&e.openedOnBlock.classList.remove("toolbar-opened"),e.openedOnBlock=null,t.nodes.toolbox.classList.remove("opened"),t.nodes.plusButton.classList.remove("clicked"),t.modules.toolbar.toolbox.opened=!1,t.modules.toolbar.current=null},e.leaf=function(){var e=t.modules.toolbar.current,o=Object.keys(t.tools),n=t.nodes.toolbarButtons,r=0,s=void 0,l=void 0,i=void 0;if(e)for(r=(o.indexOf(e)+1)%o.length,l=o[r];!t.tools[l].displayInToolbox;)r=(r+1)%o.length,l=o[r];else for(i in t.tools){if(t.tools[i].displayInToolbox)break;r++}s=o[r];for(var a in n)n[a].classList.remove("selected");n[s].classList.add("selected"),t.modules.toolbar.current=s},e.toolClicked=function(e){var o,n,r,s=["image","link","list","instagram","twitter","embed"],l=t.tools[t.modules.toolbar.current],i=t.modules.content.currentNode,a=t.modules.caret.inputIndex;o=t.modules.renderer.makeBlockFromData({type:l.type}),r={block:o,type:l.type,stretched:!1},i&&s.indexOf(i.dataset.tool)===-1&&""===i.textContent.trim()?t.modules.content.switchBlock(i,o,l.type):(t.modules.content.insertBlock(r),a++),n=l.appendCallback,n&&"function"==typeof n&&n.call(e),window.setTimeout(function(){t.modules.caret.setToBlock(a)},10),t.modules.content.workingNodeChanged(),t.modules.toolbar.move()},e}},function(e,t){"use strict";e.exports=function(){var e={},t=this;e.globalKeydown=function(e){switch(e.keyCode){case t.modules.core.keys.ENTER:n(e)}},e.redactorKeyDown=function(e){switch(e.keyCode){case t.modules.core.keys.TAB:o(e);break;case t.modules.core.keys.ENTER:s(e);break;case t.modules.core.keys.ESC:l(e);break;default:a(e)}},e.globalKeyup=function(e){switch(e.keyCode){case t.modules.core.keys.UP:case t.modules.core.keys.LEFT:case t.modules.core.keys.RIGHT:case t.modules.core.keys.DOWN:i(e)}};var o=function(e){e.preventDefault(),t.modules.core.isBlockEmpty(t.modules.content.currentNode)&&(t.modules.toolbar.opened||t.modules.toolbar.open(),t.modules.toolbar.opened&&!t.modules.toolbar.toolbox.opened?t.modules.toolbar.toolbox.open():t.modules.toolbar.toolbox.leaf())},n=function(){t.modules.content.editorAreaHightlighted&&(t.modules.caret.inputIndex=-1,r())},r=function(){var e=t.settings.initialBlockPlugin;t.modules.content.insertBlock({type:e,block:t.tools[e].render()},!0),t.modules.toolbar.move(),t.modules.toolbar.open()},s=function(e){"true"==e.target.contentEditable&&t.modules.caret.saveCurrentInputIndex();var o=t.modules.caret.getCurrentInputIndex()||0,n=t.modules.content.currentNode,r=n.dataset.tool,s=t.modules.toolbar.opened&&t.modules.toolbar.current&&e.target==t.state.inputs[o],l=t.tools[r].enableLineBreaks,i=t.settings.initialBlockPlugin;if(s)return e.preventDefault(),t.modules.toolbar.toolbox.toolClicked(e),t.modules.toolbar.close(),e.stopPropagation(),void e.stopImmediatePropagation();if(e.shiftKey||l)return e.stopPropagation(),void e.stopImmediatePropagation();var a=window.getSelection(),d=a.anchorNode,c=t.modules.caret.position.atTheEnd(),u=!1;if(e.shiftKey&&!l)return t.modules.callback.enterPressedOnBlock(t.modules.content.currentBlock,e),void e.preventDefault();if(u=d&&"true"!=d.parentNode.contentEditable,d.nodeType!=t.modules.core.nodeTypes.TEXT||u||c){var m=t.modules.content.isLastNode(d);m&&c&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),t.modules.core.log("ENTER clicked in last textNode. Create new BLOCK"),t.modules.content.insertBlock({type:i,block:t.modules.renderer.makeBlockFromData({type:i})},!0),t.modules.toolbar.move(),t.modules.toolbar.open(),t.modules.toolbar.showPlusButton())}else e.preventDefault(),t.modules.core.log("Splitting Text node..."),t.modules.content.splitBlock(o),t.state.inputs[o+1].textContent.trim()||t.modules.toolbar.showPlusButton();t.modules.ui.saveInputs()},l=function(e){t.modules.toolbar.close(),t.modules.toolbar.toolbox.close(),e.preventDefault()},i=function(e){t.modules.content.workingNodeChanged(),t.modules.toolbar.close(),t.modules.toolbar.move()},a=function(){t.modules.toolbar.close(),
t.modules.toolbar.inline.actionsOpened||(t.modules.toolbar.inline.close(),t.modules.content.clearMark())};e.redactorClicked=function(e){d(),t.modules.content.workingNodeChanged(e.target),t.modules.ui.saveInputs();var o,n=t.modules.toolbar.inline.getSelectionText();if(0===n.length&&t.modules.toolbar.inline.close(),"true"==e.target.contentEditable&&t.modules.caret.saveCurrentInputIndex(),null===t.modules.content.currentNode){var r=t.state.inputs.length>0?t.state.inputs.length-1:0;if(t.state.inputs.length&&(o=t.modules.content.getFirstLevelBlock(t.state.inputs[r])),t.state.inputs.length&&""===t.state.inputs[r].textContent&&o.dataset.tool==t.settings.initialBlockPlugin)t.modules.caret.setToBlock(r);else{var s=t.settings.initialBlockPlugin;t.modules.content.insertBlock({type:s,block:t.modules.renderer.makeBlockFromData({type:s})}),1===t.state.inputs.length?t.modules.caret.setToBlock(r):t.modules.caret.setToNextBlock(r)}}else t.modules.toolbar.settings.close(),t.modules.toolbar.toolbox.close();t.modules.toolbar.move(),t.modules.toolbar.open();var l=!t.modules.content.currentNode.textContent.trim(),i=t.modules.content.currentNode.dataset.tool,a=i==t.settings.initialBlockPlugin;t.modules.toolbar.hidePlusButton(),l||t.modules.content.markBlock(),a&&l&&t.modules.toolbar.showPlusButton()};var d=function(){var e=window.getSelection(),o=e.anchorNode,n=!1;if(0===e.rangeCount)t.modules.content.editorAreaHightlighted=!0;else{for(t.modules.core.isDomNode(o)||(o=o.parentNode),"true"==o.contentEditable&&(n=!0);"true"!=o.contentEditable&&(o=o.parentNode,"true"==o.contentEditable&&(n=!0),o!=document.body););t.modules.content.editorAreaHightlighted=!n}};e.toolbarButtonClicked=function(e){var o=this;t.modules.toolbar.current=o.dataset.type,t.modules.toolbar.toolbox.toolClicked(e),t.modules.toolbar.close()},e.plusButtonClicked=function(){t.nodes.toolbox.classList.contains("opened")?t.modules.toolbar.toolbox.close():t.modules.toolbar.toolbox.open()},e.blockKeydown=function(e){var o=e.target;switch(e.keyCode){case t.modules.core.keys.DOWN:case t.modules.core.keys.RIGHT:c(e);break;case t.modules.core.keys.BACKSPACE:m(o,e);break;case t.modules.core.keys.UP:case t.modules.core.keys.LEFT:u(e)}};var c=function(e){var o,n=window.getSelection(),r=t.state.inputs,s=n.anchorNode;if(!s)return!1;for(;"true"!=s.contentEditable;)o=s.parentNode,s=o;for(var l=0;s!=r[l];)l++;if(!s.textContent)return void t.modules.caret.setToNextBlock(l);var i,a,d=!1,c=!1;return i=s.childNodes[s.childNodes.length-1],a=t.core.isDomNode(i)?t.modules.content.getDeepestTextNodeFromPosition(i,i.childNodes.length):i,d=n.anchorNode==a,c=a.length==n.anchorOffset,d&&c?void t.modules.caret.setToNextBlock(l):(t.modules.core.log("arrow [down|right] : caret does not reached the end"),!1)},u=function(e){var o,n=window.getSelection(),r=t.state.inputs,s=n.anchorNode;if(!s)return!1;if(0!==n.anchorOffset)return!1;for(;"true"!=s.contentEditable;)o=s.parentNode,s=o;for(var l=0;s!=r[l];)l++;var i,a,d=!1,c=!1;return s.textContent?(i=s.childNodes[0],a=t.modules.core.isDomNode(i)?t.modules.content.getDeepestTextNodeFromPosition(i,0):i,d=n.anchorNode==a,c=0===n.anchorOffset,void(d&&c&&t.modules.caret.setToPreviousBlock(l))):void t.modules.caret.setToPreviousBlock(l)},m=function(e,o){var n,r,s,l=t.modules.caret.getCurrentInputIndex();if(t.modules.core.isNativeInput(o.target)){if(""!=o.target.value.trim())return;e.remove()}if(e.textContent.trim()){if(n=t.modules.content.getRange(),r=n.endOffset-n.startOffset,!t.modules.caret.position.atStart()||r||!t.state.inputs[l-1])return;t.modules.content.mergeBlocks(l)}r||e.remove(),s=t.nodes.redactor.childNodes.length,0===s?(t.modules.content.currentNode=null,t.modules.ui.addInitialBlock(),t.modules.ui.saveInputs(),window.setTimeout(function(){t.modules.caret.setToPreviousBlock(1)},10)):0!==t.modules.caret.inputIndex?t.modules.caret.setToPreviousBlock(t.modules.caret.inputIndex):t.modules.caret.setToNextBlock(t.modules.caret.inputIndex),t.modules.toolbar.move(),t.modules.toolbar.opened||t.modules.toolbar.open(),t.modules.ui.saveInputs(),o.preventDefault()};return e.showSettingsButtonClicked=function(e){var o=t.modules.content.currentNode.childNodes[0].childNodes[0].tool;t.modules.toolbar.settings.toggle(o),t.modules.toolbar.toolbox.close(),t.modules.toolbar.settings.hideRemoveActions()},e}},function(e,t){"use strict";e.exports=function(){var e={};return e.wrapper=function(){var e=document.createElement("div");return e.className+="codex-editor",e},e.redactor=function(){var e=document.createElement("div");return e.className+="ce-redactor",e},e.ceBlock=function(){var e=document.createElement("DIV");return e.className+="ce_block",e},e.toolbar=function(){var e=document.createElement("div");return e.className+="ce-toolbar",e},e.toolbarContent=function(){var e=document.createElement("DIV");return e.classList.add("ce-toolbar__content"),e},e.inlineToolbar=function(){var e=document.createElement("DIV");return e.className+="ce-toolbar-inline",e},e.inlineToolbarButtons=function(){var e=document.createElement("DIV");return e.className+="ce-toolbar-inline__buttons",e},e.inlineToolbarActions=function(){var e=document.createElement("DIV");return e.className+="ce-toolbar-inline__actions",e},e.inputForLink=function(){var e=document.createElement("INPUT");return e.type="input",e.className+="inputForLink",e.placeholder="Вставьте ссылку ...",e.setAttribute("form","defaultForm"),e.setAttribute("autofocus","autofocus"),e},e.blockButtons=function(){var e=document.createElement("div");return e.className+="ce-toolbar__actions",e},e.blockSettings=function(){var e=document.createElement("div");return e.className+="ce-settings",e},e.defaultSettings=function(){var e=document.createElement("div");return e.classList.add("ce-settings_default"),e},e.pluginsSettings=function(){var e=document.createElement("div");return e.classList.add("ce-settings_plugin"),e},e.plusButton=function(){var e=document.createElement("span");return e.className="ce-toolbar__plus",e},e.settingsButton=function(){var e=document.createElement("span");return e.className="ce-toolbar__settings-btn",e.innerHTML='<i class="ce-icon-cog"></i>',e},e.toolbox=function(){var e=document.createElement("div");return e.className="ce-toolbar__tools",e},e.toolbarButton=function(e,t){var o=document.createElement("li"),n=document.createElement("i"),r=document.createElement("span");return o.dataset.type=e,o.setAttribute("title",e),n.classList.add(t),r.classList.add("ce_toolbar_tools--title"),o.appendChild(n),o.appendChild(r),o},e.toolbarButtonInline=function(e,t){var o=document.createElement("BUTTON"),n=document.createElement("I");return o.type="button",o.dataset.type=e,n.classList.add(t),o.appendChild(n),o},e.block=function(e,t){var o=document.createElement(e);return o.innerHTML=t||"",o},e.node=function(e,t,o){var n=document.createElement(e);if(t&&(n.className=t),o)for(var r in o)n[r]=o[r];return n},e.unavailableBlock=function(){var e=document.createElement("DIV");return e.classList.add("cdx-unavailable-block"),e},e}},function(e,t){"use strict";e.exports=function(){var e={},t=this;return e.inputIndex=null,e.offset=null,e.focusedNodeIndex=null,e.set=function(o,n,r){r=r||e.offset||0,n=n||e.focusedNodeIndex||0;var s,l=o.childNodes;if(s=0===l.length?o:l[n],"true"!=o.contentEditable)return void o.focus();t.modules.core.isDomNode(s)&&(s=t.modules.content.getDeepestTextNodeFromPosition(s,s.childNodes.length));var i=document.createRange(),a=window.getSelection();window.setTimeout(function(){i.setStart(s,r),i.setEnd(s,r),a.removeAllRanges(),a.addRange(i),t.modules.caret.saveCurrentInputIndex()},20)},e.saveCurrentInputIndex=function(){var o,n=window.getSelection(),r=t.state.inputs,s=n.anchorNode;if(s){for(;"true"!=s.contentEditable;)o=s.parentNode,s=o;for(var l=0;s!=r[l];)l++;e.inputIndex=l}},e.getCurrentInputIndex=function(){return e.inputIndex},e.setToNextBlock=function(e){var o=t.state.inputs,n=o[e+1];if(!n)return void t.modules.core.log("We are reached the end");if(!n.childNodes.length){var r=document.createTextNode("");n.appendChild(r)}t.modules.caret.inputIndex=e+1,t.modules.caret.set(n,0,0),t.modules.content.workingNodeChanged(n)},e.setToBlock=function(e){var o=t.state.inputs,n=o[e];if(n){if(!n.childNodes.length){var r=document.createTextNode("");n.appendChild(r)}t.modules.caret.inputIndex=e,t.modules.caret.set(n,0,0),t.modules.content.workingNodeChanged(n)}},e.setToPreviousBlock=function(e){e=e||0;var o,n,r,s=t.state.inputs,l=s[e-1];return l?(o=t.modules.content.getDeepestTextNodeFromPosition(l,l.childNodes.length),n=o.length,l.childNodes.length||(r=document.createTextNode(""),l.appendChild(r)),t.modules.caret.inputIndex=e-1,t.modules.caret.set(l,l.childNodes.length-1,n),void t.modules.content.workingNodeChanged(s[e-1])):void t.modules.core.log("We are reached first node")},e.position={atStart:function(){var e=window.getSelection(),o=e.anchorOffset,n=e.anchorNode,r=t.modules.content.getFirstLevelBlock(n),s=r.childNodes[0];t.modules.core.isDomNode(n)||(n=n.parentNode);var l=n===s.childNodes[0],i=0===o;return l&&i},atTheEnd:function(){var e=window.getSelection(),t=e.anchorOffset,o=e.anchorNode;return!o||!o.length||t===o.length}},e.insertNode=function(e){var o,n,r=e;e.nodeType==t.modules.core.nodeTypes.DOCUMENT_FRAGMENT&&(r=e.lastChild),o=window.getSelection(),n=o.getRangeAt(0),n.deleteContents(),n.insertNode(e),n.setStartAfter(r),n.collapse(!0),o.removeAllRanges(),o.addRange(n)},e}},function(e,t){"use strict";e.exports=function(){var e={},t=this,o=[],n=function(e){o.push(e);for(var t=0;t<o.length&&o.length>5;)"confirm"!=o[t].type&&"prompt"!=o[t].type?(o[t].close(),o.splice(t,1)):t++};return e.createHolder=function(){var e=t.modules.draw.node("DIV","cdx-notifications-block");return t.nodes.notifications=document.body.appendChild(e),e},e.errorThrown=function(e,o){t.modules.notifications.notification({message:"This action is not available currently",type:o.type})},e.notification=function(e){function o(e){if(!e||!e.message)return void t.modules.core.log("Can't create notification. Message is missed");e.type=e.type||"alert",e.time=1e3*e.time||1e4;var o=t.modules.draw.node("DIV","cdx-notification"),n=t.modules.draw.node("DIV","cdx-notification__message"),r=t.modules.draw.node("INPUT","cdx-notification__input"),p=t.modules.draw.node("SPAN","cdx-notification__ok-btn"),f=t.modules.draw.node("SPAN","cdx-notification__cancel-btn");n.textContent=e.message,p.textContent=e.okMsg||"ОК",f.textContent=e.cancelMsg||"Отмена",t.modules.listeners.add(p,"click",u),t.modules.listeners.add(f,"click",m),o.appendChild(n),"prompt"==e.type&&o.appendChild(r),o.appendChild(p),"prompt"!=e.type&&"confirm"!=e.type||o.appendChild(f),o.classList.add("cdx-notification-"+e.type),o.dataset.type=e.type,l=o,a=e.type,d=e.confirm,i=e.cancel,c=r,"prompt"!=e.type&&"confirm"!=e.type&&window.setTimeout(s,e.time)}function r(){t.nodes.notifications.appendChild(l),c.focus(),t.nodes.notifications.classList.add("cdx-notification__notification-appending"),window.setTimeout(function(){t.nodes.notifications.classList.remove("cdx-notification__notification-appending")},100),n({type:a,close:s})}function s(){l.remove()}var l=null,i=null,a=null,d=null,c=null,u=function(){if(s(),"function"==typeof d)return"prompt"==a?void d(c.value):void d()},m=function(){s(),"function"==typeof i&&i()};return e&&(o(e),r()),{create:o,send:r,close:s}},e.clear=function(){t.nodes.notifications.innerHTML="",o=[]},e}},function(e,t){"use strict";e.exports=function(){var e={},t=this;return e.insertPastedContent=function(e,o){t.modules.content.insertBlock({type:e.type,block:e.render({text:o.innerHTML})})},e.isFirstLevelBlock=function(e){return e.nodeType==t.modules.core.nodeTypes.TAG&&e.classList.contains(t.modules.ui.className.BLOCK_CLASSNAME)},e}},function(e,t,o){"use strict";e.exports=function(){var e={},t=o(18),n=this;e.prepare=function(){n.settings.sanitizer&&!n.modules.core.isEmpty(n.settings.sanitizer)&&(r.CUSTOM=n.settings.sanitizer)};var r={CUSTOM:null,BASIC:{tags:{p:{},a:{href:!0,target:"_blank",rel:"nofollow"}}}};e.Config=r;var s=function(e){var o=e||r.CUSTOM||r.BASIC;return new t(o)};return e.clean=function(e,t){var o=s(t);return o.clean(e)},e}},function(e,t,o){var n,r;!function(s,l){n=l,r="function"==typeof n?n.call(t,o,t,e):n,!(void 0!==r&&(e.exports=r))}(this,function(){function e(e){var t=e.tags,o=Object.keys(t),n=o.map(function(e){return typeof t[e]}).every(function(e){return"object"===e||"boolean"===e||"function"===e});if(!n)throw new Error("The configuration was invalid");this.config=e}function t(e){return i.indexOf(e.nodeName)!==-1}function o(e){return a.indexOf(e.nodeName)!==-1}function n(e){return document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,null,!1)}function r(e,t,o){return"function"==typeof e.tags[t]?e.tags[t](o):e.tags[t]}function s(e,t){return"undefined"==typeof t||"boolean"==typeof t&&!t}function l(e,t,o){var n=e.name.toLowerCase();return t!==!0&&("function"==typeof t[n]?!t[n](e.value,o):"undefined"==typeof t[n]||(t[n]===!1||"string"==typeof t[n]&&t[n]!==e.value))}var i=["P","LI","TD","TH","DIV","H1","H2","H3","H4","H5","H6","PRE"],a=["A","B","STRONG","I","EM","SUB","SUP","U","STRIKE"];return e.prototype.clean=function(e){var t=document.createElement("div");return t.innerHTML=e,this._sanitize(t),t.innerHTML},e.prototype._sanitize=function(e){var i=n(e),a=i.firstChild();if(a)do if(!a._sanitized)if(a.nodeType!==Node.TEXT_NODE){if(a.nodeType===Node.COMMENT_NODE){e.removeChild(a),this._sanitize(e);break}var d,c=o(a);c&&(d=Array.prototype.some.call(a.childNodes,t));var u=!!e.parentNode,m=t(e)&&t(a)&&u,p=a.nodeName.toLowerCase(),f=r(this.config,p,a),h=c&&d;if(h||s(a,f)||!this.config.keepNestedBlockElements&&m){if("SCRIPT"!==a.nodeName&&"STYLE"!==a.nodeName)for(;a.childNodes.length>0;)e.insertBefore(a.childNodes[0],a);e.removeChild(a),this._sanitize(e);break}for(var g=0;g<a.attributes.length;g+=1){var v=a.attributes[g];l(v,f,a)&&(a.removeAttribute(v.name),g-=1)}this._sanitize(a),a._sanitized=!0}else if(""===a.data.trim()&&(a.previousElementSibling&&t(a.previousElementSibling)||a.nextElementSibling&&t(a.nextElementSibling))){e.removeChild(a),this._sanitize(e);break}while(a=i.nextSibling())},e})},function(e,t){"use strict";e.exports=function(){var e={},t=[];return e.search=function(){var e=function(e,o){var n=[];o=o||t;for(var r=0;r<o.length;r++){var s=o[r];s.element===e&&n.push(s)}return n},o=function(e,o){var n=[];o=o||t;for(var r=0;r<o.length;r++){var s=o[r];s.type===e&&n.push(s)}return n},n=function(e,o){var n=[];o=o||t;for(var r=0;r<o.length;r++){var s=o[r];s.handler===e&&n.push(s)}return n},r=function(r,s,l){var i=t;return r&&(i=e(r,i)),s&&(i=o(s,i)),l&&(i=n(l,i)),i[0]},s=function(r,s,l){var i=t;return r&&(i=e(r,i)),s&&(i=o(s,i)),l&&(i=n(l,i)),i};return{byElement:e,byType:o,byHandler:n,one:r,all:s}}(),e.add=function(o,n,r,s){o.addEventListener(n,r,s);var l={element:o,type:n,handler:r},i=e.search.one(o,n,r);i||t.push(l)},e.remove=function(o,n,r){o.removeEventListener(n,r);for(var s=e.search.all(o,n,r),l=0;l<s.length;l++){var i=t.indexOf(s[l]);i>0&&t.splice(i,1)}},e.removeAll=function(){t.map(function(t){e.remove(t.element,t.type,t.handler)})},e.get=function(t,o,n){return e.search.all(t,o,n)},e}},function(e,t){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(){var e={},t=this;return e.removeNodes=function(){t.nodes.wrapper.remove(),t.nodes.notifications.remove()},e.destroyPlugins=function(){for(var e in t.tools)"function"==typeof t.tools[e].destroy&&t.tools[e].destroy()},e.destroyScripts=function(){for(var e=document.getElementsByTagName("SCRIPT"),o=0;o<e.length;o++)e[o].id.indexOf(t.scriptPrefix)+1&&(e[o].remove(),o--)},e.destroy=function(n){n&&"object"===("undefined"==typeof n?"undefined":o(n))&&(n.ui&&(e.removeNodes(),t.modules.listeners.removeAll()),n.scripts&&e.destroyScripts(),n.plugins&&e.destroyPlugins(),n.ui&&n.scripts&&n.core&&(t=null))},e}},function(e,t){"use strict";e.exports=function(){var e={},t=this,o=[];e.prepare=function(){var e=t.tools;for(var n in e)e[n].renderOnPastePatterns&&Array.isArray(e[n].renderOnPastePatterns)&&e[n].renderOnPastePatterns.map(function(e){o.push(e)});return Promise.resolve()},e.pasted=function(e){var t=e.clipboardData||window.clipboardData,o=t.getData("Text"),r=n(o);return r&&(e.preventDefault(),e.stopImmediatePropagation()),r};var n=function(e){var n=!1,s=t.modules.content.currentNode,l=s.dataset.tool;return o.map(function(o){var i=o.regex.exec(e),a=i&&i[0];a&&a===e.trim()&&(s.textContent.trim()&&l==t.settings.initialBlockPlugin&&r(),o.callback(e,o),n=!0)}),n},r=function(){t.modules.content.insertBlock({type:t.settings.initialBlockPlugin,block:t.tools[t.settings.initialBlockPlugin].render({text:""})},!1)};e.blockPasteCallback=function(e){if(s(e.target)){e.preventDefault();var o,n,r=e.clipboardData.getData("text/html"),a=e.clipboardData.getData("text/plain"),d=t.modules.draw.node("DIV","",{});return o=t.modules.sanitizer.clean(r),n=t.modules.content.wrapTextWithParagraphs(o,a),d.innerHTML=n,1==d.childNodes.length?void i(d.firstChild):void l(d.childNodes)}};var s=function(e){if(t.modules.core.isNativeInput(e))return!1;var o=t.modules.content.getEditableParent(e);return!!o},l=function(e){var o=t.settings.initialBlockPlugin,n=t.modules.content.currentNode;e.forEach(function(e){t.modules.core.isBlockEmpty(e)||(t.modules.content.insertBlock({type:o,block:t.tools[o].render({text:e.innerHTML})}),t.modules.caret.inputIndex++)}),t.modules.caret.setToPreviousBlock(t.modules.caret.getCurrentInputIndex()+1),t.modules.core.isBlockEmpty(n)&&(n.remove(),t.modules.ui.saveInputs())},i=function(e){var o;e.childElementCount?(o=document.createDocumentFragment(),e.childNodes.forEach(function(e){(t.modules.core.isDomNode(e)||""!==e.data.trim())&&o.appendChild(e.cloneNode(!0))})):o=document.createTextNode(e.textContent),t.modules.caret.insertNode(o)};return e}}]);
//# sourceMappingURL=codex-editor.js.map